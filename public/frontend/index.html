<html>
<head>
    <meta charset="UTF-8">
    <title>Countries search</title>
    <link href="style.css" rel="stylesheet">
</head>

<body>
<div class="container main">
    <div class="row">
        <div class="col-sm-8">
            <form id="search-form">
                <div class="input-group">
                    <label for="searchCode"><b>Code</b></label>
                    <input type="text" name="code" id="searchCode" class="form-control">

                    <label for="searchName"><b>Name</b></label>
                    <input type="text" name="name" id="searchName" class="form-control">

                    <button class="btn btn-info" type="submit" id="search">Search</button>
                </div>
            </form>

            <form id="update-form">
                <div class="input-group">
                    <label for="updateId"><b>Id</b></label>
                    <input type="text" name="updateId" id="updateId" class="form-control">

                    <label for="updateName"><b>Name</b></label>
                    <input type="text" name="name" id="updateName" class="form-control">

                    <label for="updateCode"><b>Code</b></label>
                    <input type="text" name="code" id="updateCode" class="form-control">

                    <label for="updatePrefix"><b>Prefix</b></label>
                    <input type="text" name="prefix" id="updatePrefix" class="form-control">

                    <button id="update">Update</button>
                </div>
            </form>

            <script type="application/javascript">
                let hostname = window.location.hostname;
                let backendBaseUrl = 'http://' + hostname + ':8888';
                let searchButton = document.getElementById('search');
                let updateButton = document.getElementById('update');

                let searchData = () => {
                    let countriesCode = 'CA';
                    let countriesName = 'Canada';

                    let url = backendBaseUrl + '/api/countries/search?code=' + countriesCode + '&name=' + countriesName;
                    console.log(url);
                    let request = new XMLHttpRequest();

                    request.open('GET', url);
                    request.setRequestHeader('content-type', 'application/json');

                    request.onload = () => {
                        let countries = JSON.parse(request.response)['hydra:member'];

                        console.log(countries);
                    };

                    request.send();
                }

                let updateData = () => {
                    let url = backendBaseUrl + '/api/countries/1';

                    let request = new XMLHttpRequest();

                    let updateName = document.getElementById('updateName');
                    let updateCode = document.getElementById('updateCode');
                    let updatePrefix = document.getElementById('updatePrefix');

                    request.open('POST', url);
                    request.setRequestHeader('content-type', 'application/json');

                    request.onload = () => {
                        let countries = request.response;

                        console.log(countries);
                    };

                    request.send(JSON.stringify(
                        {
                            name: updateName.value, code: updateCode.value, prefix: updatePrefix.value
                        }
                    ));
                }

                searchButton.addEventListener('click', searchData);
                updateButton.addEventListener('click', updateData);
            </script>
        </div>
    </div>
</div>
</body>
</html>




